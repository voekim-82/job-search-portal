<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JobScope — Minimal Job Search</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@600;700;800&family=Nunito:wght@400;600&display=swap" rel="stylesheet">
  <meta name="description" content="Minimal job description search tool with salary calculator." />

  <style>
    :root{
      --bg: #000000;
      --text:#111827;
      --muted:#6b7280;
      --primary:#2563eb;
      --primary-10: rgba(37,99,235,.10);
      --card:#ffffff;
      --shadow: 0 10px 25px rgba(0,0,0,.06), 0 2px 6px rgba(0,0,0,.04);
      --radius:16px;
      --radius-sm:12px;
      --radius-xs:10px;
      --ring: 0 0 0 4px var(--primary-10);
      --gap: 14px;
      --soft: 14px;
      --font: 'Montserrat', sans-serif;
      --font-b: 'Nunito', sans-serif;
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body{
      margin:0;
      font-family: var(--font);
      background: var(--bg);
      color: var(--text);
      -webkit-font-smoothing: antialiased;
      text-rendering: optimizeLegibility;
    }

    /* Header / top bar (visible on results) */
    .topbar{
      position: sticky;
      top:0;
      background: rgba(255,255,255,.8);
      backdrop-filter: saturate(180%) blur(12px);
      border-bottom: 1px solid #eef2f7;
      z-index: 10;
    }
    .topbar__inner{
      max-width: 980px;
      margin: 0 auto;
      padding: 10px 16px;
      display: grid;
      grid-template-columns: 160px 1fr auto;
      align-items: center;
      gap: 12px;
    }

    /* Centered hero (home) */
    .hero{
      min-height: 100dvh;
      display: grid;
      place-items: center;
      padding: 22px;
    }
    .hero__inner{
      width: 100%;
      max-width: 680px;
      display: grid;
      justify-items: center;
      gap: 24px;
      text-align: center;
      animation: fadeUp .5s ease-out both;
    }

    .logo{
      width: 180px; height: 56px;
      border-radius: var(--radius);
      display: grid; place-items: center;
      box-shadow: var(--shadow);
      background: linear-gradient(135deg,#f9fafb,#eef2ff);
      color:#1f2937;
      letter-spacing: .5px;
      font-weight: 800;
    }
    .logo i{
      display:inline-block;
      width:8px; height:8px; border-radius:50%;
      background: var(--primary);
      margin-left:6px;
      box-shadow: 12px 0 0 #10b981, 24px 0 0 #f59e0b, 36px 0 0 #ef4444;
    }
    .intro { 
        font-size:15px; 
        color:var(--muted); 
        max-width:540px; 
        font-family: var(--font-b);
    }

    /* Search */
    .search{
      width:100%;
      display:flex;
      gap:8px;
      align-items: center;
    }
    .input{
      appearance:none;
      width:100%;
      padding: 14px 16px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      box-shadow: var(--shadow);
      font-family: var(--font-b);
      font-size: 16px;
      outline: none;
      transition: box-shadow .15s, border-color .15s;
    }
    .input:focus{
      border-color: var(--primary);
      box-shadow: var(--shadow), var(--ring);
    }
    .btn{
      appearance: none;
      border: none;
      background: var(--primary);
      color: #fff;
      padding: 12px 18px;
      border-radius: 999px;
      font-family: var(--font);
      font-weight: 600;
      cursor: pointer;
      transition: transform .06s ease, box-shadow .2s ease, background .2s ease;
      box-shadow: 0 8px 18px rgba(37,99,235,.25);
    }
    .btn:hover{ transform: translateY(-1px); }
    .btn:active{ transform: translateY(0); }
    .btn--ghost{
      background: #f3f4f6; color:#111827; box-shadow: none;
    }
    .btn--chip{
      background:#eef2ff; color:#3730a3; padding:6px 10px; border-radius: 999px; font-size:12px;
    }

    /* Results layout */
    .wrap{
      max-width: 980px;
      margin: 24px auto 80px;
      padding: 0 16px;
    }
    .results{
      display: grid;
      gap: 18px;
      animation: fadeIn .4s ease both;
    }
    .card{
      background: var(--card);
      border: 1px solid #edf2f7;
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 18px;
    }
    .card--soft{
      border-radius: var(--radius-sm);
    }
    .title{
      margin:0 0 6px;
      font-size: 22px;
      line-height: 1.25;
    }
    .subtitle{
      margin:0; color: var(--muted); font-size:14px;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap: 16px;
    }
    .grid--2{
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }
    .grid--3{
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 12px;
    }

    .table{
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
      overflow: hidden;
      border-radius: var(--radius-sm);
    }
    .table th, .table td{
      text-align: left;
      padding: 12px 10px;
      border-bottom: 1px solid #eef2f7;
      vertical-align: top;
    }
    .table th{
      background:#f8fafc;
      color:#334155;
      font-weight: 700;
      font-size: 12px;
      letter-spacing: .02em;
      text-transform: uppercase;
    }
    .badge{
      display:inline-flex; align-items:center; gap:6px;
      padding: 6px 10px;
      border-radius: 999px;
      background:#f1f5f9; color:#0f172a;
      font-size:12px; font-weight:600;
    }
    .pill{
      display:inline-block; padding:6px 10px; border-radius:999px; background:#f8fafc; border:1px solid #eef2f7; font-size:12px;
    }
    .muted{ color: var(--muted); }
    .mono{ font-variant-numeric: tabular-nums; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; }

    /* Calculator */
    .calc__row{
      display:grid; grid-template-columns: 1fr 130px; gap: 10px; align-items:center;
    }
    .calc__row input[type="number"]{
      width:100%; padding:10px 12px; border:1px solid #e5e7eb; border-radius:10px; outline:none; transition:border .15s, box-shadow .15s;
    }
    .calc__row input:focus{ border-color: var(--primary); box-shadow: var(--ring); }
    .calc__row label{ font-size: 13px; color:#334155; }
    .calc__total{
      display:flex; align-items: baseline; gap: 10px; justify-content: space-between; padding-top: 8px; border-top:1px dashed #e5e7eb;
    }
    .calc__total .big{ font-weight: 800; font-size: clamp(20px, 4.5vw, 28px); }
    .calc__extras{
      display:flex; flex-wrap:wrap; gap:8px; margin-top:10px; margin-bottom: 10px;
    }

    /* Animations */
    @keyframes fadeIn{ from{ opacity:0; transform: translateY(6px);} to{ opacity:1; transform: none; } }
    @keyframes fadeUp{ from{ opacity:0; transform: translateY(8px);} to{ opacity:1; transform: none; } }

    /* Responsive */
    @media (max-width: 800px){
      .grid{ grid-template-columns: 1fr; }
      .topbar__inner{ grid-template-columns: 120px 1fr; }
      .hero__inner{ max-width: 92vw; }
    }

    /* Hide results area until search */
    .hidden{ display:none !important; }
    .sr-only{
      position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0;
    }
  </style>
</head>
<body>

  <!-- Home (centered) -->
  <main id="home" class="hero">
    <section class="hero__inner">
      <div class="logo" aria-label="JobScope Logo">JobScope <i aria-hidden="true"></i></div>
      <div class="intro">Search for a job title to instantly view its description, grade, and recommended salaries. Use the built-in calculators to estimate your total pay package and allowances.</div>
      <form id="homeSearchForm" class="search" autocomplete="off" role="search" aria-label="Job search">
        <label class="sr-only" for="homeQuery">Search job title</label>
        <input id="homeQuery" class="input" name="q" placeholder="Search job title (e.g., General Hand)" required autofocus />
        <button class="btn" type="submit" aria-label="Search jobs">Search</button>
      </form>
      <div class="muted" style="font-size:13px;"> <!--Edit this to post relevant 
        job titles-->
        Try: <button class="btn btn--chip" data-demo="Software Engineer" type="button">Software Engineer</button>
        <button class="btn btn--chip" data-demo="Project Manager" type="button">Project Manager</button>
        <button class="btn btn--chip" data-demo="Registered Nurse" type="button">Registered Nurse</button>
      </div>
    </section>
  </main>

  <!-- Results view -->
  <header id="resultsHeader" class="topbar hidden" role="banner">
    <div class="topbar__inner">
      <div class="logo" style="width:140px;height:44px;font-size:16px;">JobLens <i></i></div>

      <form id="resultsSearchForm" class="search" role="search" aria-label="Job search (results)">
        <label class="sr-only" for="resultsQuery">Search job title</label>
        <input id="resultsQuery" class="input" name="q" placeholder="Search another job title…" required />
        <button class="btn" type="submit">Search</button>
      </form>

      <!--Change the button to send user to about page-->
      <button id="backHomeBtn" class="btn btn--ghost" type="button" aria-label="Back to home">Learn more</button>
    </div>
  </header>

  <section id="results" class="wrap hidden" aria-live="polite" aria-busy="false">
    <div class="results">
      <!-- Job Summary -->
      <article id="jobCard" class="card" style="display:none;">
        <h1 class="title" id="jobTitle">—</h1>
        <p class="subtitle" id="jobMeta">—</p>
        <div class="grid" style="margin-top:12px;">
          <div class="card card--soft">
            <h3 style="margin:0 0 8px;">Job Description</h3>
            <p id="jobDesc" style="margin:0; line-height:1.6; font-family: var(--font-b);"></p>
          </div>

          <div class="card card--soft">
            <div style="display:flex;justify-content:space-between;align-items:center; gap:10px;">
              <h3 style="margin:0;">Job Details</h3>
              <span id="jobGradeBadge" class="badge">Grade: —</span>
            </div>
            <table class="table" style="margin-top:10px;">
              <thead>
                <tr><th>Institution Type</th><th>Recommended Basic</th></tr>
              </thead>
              <tbody id="salaryRows"></tbody>
            </table>

            <div style="display:flex; align-items:center; gap:10px; margin-top:10px;">
              <label for="currencySelect" class="muted" style="font-size:12px;">Currency</label>
              <select id="currencySelect" style="padding:8px 10px; border:1px solid #e5e7eb; border-radius:10px; font-family: var(--font-b);">
                <option value="USD" selected>USD $</option>
                <option value="ZWL">ZWL </option>
              <div id="zwlRateWrapper" style="display:none; margin-top:8px;">
  <label for="zwlRate" class="muted" style="font-size:12px;">Enter 1 USD = ? ZWL</label>
  <input id="zwlRate" type="number" min="0" step="0.01" value="13" style="padding:6px 10px; border:1px solid #e5e7eb; border-radius:8px; font-family: var(--font-b);" />
</div>
  
              </select>

              <label for="instSelect" class="muted" style="font-size:12px; margin-left:8px; font-family: var(--font-b);">Use as Basic</label>
              <select id="instSelect" style="padding:8px 10px; border:1px solid #e5e7eb; border-radius:10px; font-family: var(--font-b);"></select>
            </div>
          </div>
        </div>
      </article>

      <!-- Salary Calculator -->
      <article id="calcCard" class="card" style="display:none;">
        <div style="display:flex; justify-content:space-between; align-items:center; gap:8px;">
          <h3 style="margin:0;">Salary Calculator</h3>
          <span class="muted" style="font-size:12px;">Total = Basic + Allowances</span>
        </div>

        <div id="calcBody" style="margin-top:10px;">
          <div class="calc__row" style="margin-bottom:8px;">
            <label for="basicInput">Basic Salary (from selection)</label>
            <input id="basicInput" type="number" inputmode="decimal" min="0" step="0.01" />
          </div>

          <div class="grid--2" id="allowancesList" style="margin:8px 0;">
            <!-- dynamic allowance inputs -->
          </div>

          <div class="calc__extras">
            <button id="addAllowanceBtn" class="btn btn--ghost" type="button">+ Add Custom Allowance</button>
            <button id="resetCalcBtn" class="btn btn--ghost" type="button">Reset</button>
          </div>

          <div class="calc__total">
            <div><span class="muted">Allowances Total:</span> <span id="allowancesTotal" class="mono">—</span></div>
            <div><span class="muted">Grand Total:</span> <span id="grandTotal" class="big mono">—</span></div>
          </div>
        </div>
      </article>

      <!-- Recognition of Service -->
      <article id="serviceCard" class="card" style="display:none;">
        <h3>Recognition of Service Calculator</h3>
        <div class="calc__row"><label>Years of Service</label><input id="yearsService" type="number" min="0" /></div>
        <div class="calc__total">Service Allowance: <span id="serviceTotal">—</span></div>
      </article>

      <!-- Night Shift -->
      <article id="nightCard" class="card" style="display:none;">
        <h3>Night Shift Allowance Calculator</h3>
        <div class="calc__row"><label>Nights Worked</label><input id="nightsWorked" type="number" min="0" /></div>
        <div class="calc__total">Night Shift Allowance: <span id="nightTotal">—</span></div>
      </article>

      <!-- Funeral -->
      <article id="funeralCard" class="card" style="display:none;">
        <h3>Funeral Allowance Calculator</h3>
        <div class="calc__row">
          <label>Do You Have A Policy?</label>
          <select id="hasPolicy">
            <option value="yes">Yes</option>
            <option value="no">No</option>
          </select>
        </div>
        <div class="calc__row"><label>Coffin Cost</label><input id="coffinCost" type="number" min="0" /></div>
        <div class="calc__row" id="policyRow"><label>Policy Coverage</label><input id="policyCoverage" type="number" min="0" /></div>
        <div class="calc__total">Employer Covers: <span id="funeralTotal">—</span></div>
      </article>

      <!-- Suggestions / Extra Info -->
      <article id="extraCard" class="card" style="display:none;">
        <div style="display:flex;justify-content:space-between;align-items:center;">
          <h3 style="margin:0;">Suggested Additional Info</h3>
          <span class="muted" style="font-size:12px;">Helpful for candidates & HR</span>
        </div>

        <div class="grid--3" style="margin-top:10px;" id="suggestions">
          <!-- populated by JS -->
        </div>
      </article>

      <!-- Not found -->
      <article id="notFoundCard" class="card" style="display:none;">
        <h3 style="margin:0 0 6px;">No exact match found ❓</h3>
        <p class="muted" style="margin-top:0;">We couldn’t find an exact job title match. Try a simpler keyword or pick one of these close suggestions:</p>
        <div id="suggestionChips" style="display:flex;flex-wrap:wrap;gap:8px;"></div>
      </article>
    </div>
  </section>

<script>
/* ===========================
   Mock Data (JSON-like)
   =========================== */
const MOCK_JOBS = [
  {
    id: "software-engineer",
    titles: ["Software Engineer", "Software Developer", "Full Stack Developer"],
    grade: "P3",
    industry: "Technology",
    yearsExperience: "2–5 years",
    qualifications: ["BSc in Computer Science (or equivalent)", "Strong JS/TS skills", "Experience with REST/GraphQL"],
    skills: ["JavaScript", "React", "Node.js", "SQL", "Git", "Testing"],
    employers: ["Tech startups", "SaaS companies", "Consultancies"],
    description:
      "Designs, develops, tests, and maintains software systems and web applications. Collaborates with cross-functional teams to deliver features, write clean code, review PRs, and automate testing & deployment.",
    responsibilities: [
      "Implement features from specs and user stories",
      "Write maintainable, well-tested code",
      "Participate in code reviews & architecture discussions",
      "Monitor, debug, and improve performance"
    ],
    salaries: {
      Government: 1200,
      Private: 2200,
      NGO: 1800,
      Startup: 1600
    }
  },
  {
    id: "project-manager",
    titles: ["Project Manager", "Program Coordinator", "Delivery Manager"],
    grade: "M2",
    industry: "Professional Services",
    yearsExperience: "4–8 years",
    qualifications: ["Bachelor's degree", "PMP/Prince2 (preferred)"],
    skills: ["Stakeholder mgmt", "Scheduling", "Risk mgmt", "Budgeting", "Agile"],
    employers: ["IT services", "Construction firms", "Agencies"],
    description:
      "Leads project planning and execution, managing scope, timeline, budget, and stakeholder communication. Ensures delivery outcomes meet quality standards and business goals.",
    responsibilities: [
      "Define scope, milestones, and budgets",
      "Facilitate standups and status updates",
      "Manage risks, dependencies, and change requests",
      "Report progress to stakeholders"
    ],
    salaries: {
      Government: 1400,
      Private: 2600,
      NGO: 2100,
      "State-Owned": 1700
    }
  },
  {
    id: "registered-nurse",
    titles: ["Registered Nurse", "RN", "Staff Nurse"],
    grade: "C2",
    industry: "Healthcare",
    yearsExperience: "1–4 years",
    qualifications: ["Nursing diploma/degree", "Valid registration with council"],
    skills: ["Patient care", "Clinical assessment", "Charting", "Medication admin"],
    employers: ["Hospitals", "Clinics", "NGOs"],
    description:
      "Provides patient-centered nursing care, administers medications, monitors vitals, maintains records, and coordinates with multidisciplinary teams to ensure quality outcomes.",
    responsibilities: [
      "Assess, plan, implement, and evaluate care",
      "Educate patients & families",
      "Maintain accurate documentation",
      "Comply with clinical protocols"
    ],
    salaries: {
      Government: 900,
      Private: 1400,
      NGO: 1200,
      Mission: 1100
    }
  },
  {
    id: "accountant",
    titles: ["Accountant", "Financial Accountant", "General Ledger Accountant"],
    grade: "P2",
    industry: "Finance",
    yearsExperience: "2–4 years",
    qualifications: ["BCom Accounting", "ACCA/CIMA (progressing or completed)"],
    skills: ["GL", "Reconciliations", "IFRS", "Tax", "Excel"],
    employers: ["Corporate finance", "Audit firms", "SMEs"],
    description:
      "Prepares and analyzes financial records, ensures compliance with standards, manages reconciliations, journals, and supports audits and statutory reporting.",
    responsibilities: [
      "Maintain GL, prepare journals & reconciliations",
      "Assist with monthly closes & reports",
      "Support audits and compliance",
      "Liaise with external stakeholders"
    ],
    salaries: {
      Government: 1000,
      Private: 1800,
      NGO: 1500,
      "Public Practice": 1300
    }
  }
];

/* ===========================
   Utilities
   =========================== */
const $ = (sel, ctx=document) => ctx.querySelector(sel);
const $$ = (sel, ctx=document) => Array.from(ctx.querySelectorAll(sel));

const formatMoney = (n, currency='USD') => {
  if (n == null || Number.isNaN(+n)) return "—";
  // Use en-US for clean separators; currency symbol shown in label left of number
  return new Intl.NumberFormat('en-US', { maximumFractionDigits: 2 }).format(+n);
};

const normalize = s => (s||"").toLowerCase().trim();

function findJob(query){
  const q = normalize(query);
  if(!q) return null;

  // 1) Exact or includes match within titles
  for (const job of MOCK_JOBS){
    if (job.titles.map(normalize).some(t => t === q || t.includes(q) || q.includes(t))) {
      return job;
    }
  }
  // 2) Soft match: highest overlap by word intersection
  const score = (title) => {
    const a = new Set(normalize(title).split(/\s+/));
    const b = new Set(q.split(/\s+/));
    let hits = 0; for (const w of a) if (b.has(w)) hits++;
    return hits / Math.max(1, a.size);
  };
  let best = null, bestScore = 0;
  for (const job of MOCK_JOBS){
    for (const t of job.titles){
      const s = score(t);
      if (s > bestScore){ bestScore = s; best = job; }
    }
  }
  return bestScore >= 0.5 ? best : null;
}

function getSuggestions(query, max=4){
  const q = normalize(query);
  const candidates = new Map();
  for (const job of MOCK_JOBS){
    for (const t of job.titles){
      const title = t;
      const n = normalize(title);
      const base = n.includes(q) || q.includes(n) ? 2 : 0;
      const wordOverlap = n.split(/\s+/).filter(w => q.includes(w)).length;
      const score = base + wordOverlap;
      candidates.set(title, Math.max(candidates.get(title)||0, score));
    }
  }
  return [...candidates.entries()]
    .sort((a,b)=> b[1]-a[1])
    .map(([title])=>title)
    .slice(0, max);
}

/* ===========================
   DOM refs
   =========================== */
const home = $('#home');
const homeForm = $('#homeSearchForm');
const homeQuery = $('#homeQuery');

const resultsHeader = $('#resultsHeader');
const results = $('#results');
const resultsForm = $('#resultsSearchForm');
const resultsQuery = $('#resultsQuery');
const backHomeBtn = $('#backHomeBtn');

const jobCard = $('#jobCard');
const jobTitleEl = $('#jobTitle');
const jobMetaEl = $('#jobMeta');
const jobDescEl = $('#jobDesc');
const gradeBadge = $('#jobGradeBadge');
const salaryRows = $('#salaryRows');
const currencySelect = $('#currencySelect');
const zwlRateWrapper = $('#zwlRateWrapper');
const zwlRateInput = $('#zwlRate');

const instSelect = $('#instSelect');

const calcCard = $('#calcCard');
const basicInput = $('#basicInput');
const allowancesList = $('#allowancesList');
const allowancesTotalEl = $('#allowancesTotal');
const grandTotalEl = $('#grandTotal');
const addAllowanceBtn = $('#addAllowanceBtn');
const resetCalcBtn = $('#resetCalcBtn');
const serviceCard = $('#serviceCard');
const nightCard = $('#nightCard');
const funeralCard = $('#funeralCard');


const extraCard = $('#extraCard');
const suggestionsWrap = $('#suggestions');

const notFoundCard = $('#notFoundCard');
const suggestionChips = $('#suggestionChips');

/* ===========================
   State
   =========================== */
let currentJob = null;
let currentCurrency = 'USD';

/* ===========================
   Renderers
   =========================== */
function renderJob(job, q){
  currentJob = job;
  jobTitleEl.textContent = job.titles[0];
  jobMetaEl.textContent = `${job.industry} • Typical Experience: ${job.yearsExperience}`;
  jobDescEl.textContent = job.description;
  gradeBadge.textContent = `Grade: ${job.grade}`;

  // Salary table
  salaryRows.innerHTML = '';
  const instOptions = [];
  Object.entries(job.salaries).forEach(([inst, amount], idx) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${inst}</td><td class="mono" data-raw="${amount}">${currencySymbol(currentCurrency)} ${formatMoney(convertCurrency(amount, currentCurrency))}</td>`;
    salaryRows.appendChild(tr);
    instOptions.push([inst, amount]);
  });

  // Institution selector
  instSelect.innerHTML = instOptions.map(([inst, amount]) => `<option value="${amount}">${inst}</option>`).join('');
  instSelect.selectedIndex = 0;
  const selectedBasic = +instSelect.value || 0;

  // Prefill calculator
  basicInput.value = selectedBasic;
  updateCalculatorTotals();

  // Suggestions / extra info
  renderExtras(job);


  // Show all relevant sections
jobCard.style.display = '';
calcCard.style.display = '';
serviceCard.style.display = '';
nightCard.style.display = '';
funeralCard.style.display = '';
extraCard.style.display = '';
notFoundCard.style.display = 'none';

}

function renderNotFound(q){
  jobCard.style.display = 'none';
  calcCard.style.display = 'none';
  extraCard.style.display = 'none';
  notFoundCard.style.display = '';

  const suggs = getSuggestions(q, 6);
  suggestionChips.innerHTML = suggs.map(s => `<button type="button" class="btn btn--chip" data-demo="${s}">${s}</button>`).join('') ||
    `<span class="muted">No suggestions available.</span>`;
}

function renderExtras(job){
  const items = [
    { label: "Required Qualifications", content: job.qualifications },
    { label: "Years of Experience", content: [job.yearsExperience] },
    { label: "Industry", content: [job.industry] },
    { label: "Top Skills", content: job.skills },
    { label: "Common Employers", content: job.employers },
    { label: "Key Responsibilities", content: job.responsibilities.slice(0,4) },
  ];
  suggestionsWrap.innerHTML = items.map(it => `
    <div class="card card--soft">
      <div class="muted" style="font-size:12px; text-transform:uppercase; letter-spacing:.04em;">${it.label}</div>
      <div style="margin-top:8px; display:flex; flex-wrap:wrap; gap:8px;">
        ${it.content.map(v=>`<span class="pill">${escapeHTML(v)}</span>`).join('')}
      </div>
    </div>
  `).join('');
}

/* ===========================
   Calculator
   =========================== */
const DEFAULT_ALLOWANCES = [
  { name: "Housing", key: "housing", amount: 150 },
  { name: "Transport", key: "transport", amount: 80 }
];

function makeAllowanceRow(name, key, amount=0){
  const id = `allow-${key}-${Math.random().toString(36).slice(2,7)}`;
  const wrap = document.createElement('div');
  wrap.className = 'calc__row';
  wrap.innerHTML = `
    <label for="${id}">${escapeHTML(name)} Allowance</label>
    <input id="${id}" type="number" inputmode="decimal" min="0" step="0.01" value="${amount}" data-allow-key="${escapeAttr(key)}" />
  `;
  return wrap;
}

function resetAllowances(){
  allowancesList.innerHTML = '';
  DEFAULT_ALLOWANCES.forEach(a => allowancesList.appendChild(makeAllowanceRow(a.name, a.key, a.amount)));
}

function collectAllowances(){
  return $$('#allowancesList input').map(i => +i.value || 0);
}

function updateCalculatorTotals(){
  const currency = currentCurrency;
  const basic = +basicInput.value || 0;
  const allowancesTotal = collectAllowances().reduce((a,b)=>a+b, 0);
  const grand = basic + allowancesTotal;

  allowancesTotalEl.textContent = `${currencySymbol(currency)} ${formatMoney(convertCurrency(allowancesTotal, currency))}`;
  grandTotalEl.textContent = `${currencySymbol(currency)} ${formatMoney(convertCurrency(grand, currency))}`;
}

/* ===========================
   Currency (mock conversion)
   =========================== */
function currencySymbol(code){
  switch(code){
    case 'USD': return '$';
    case 'EUR': return '€';
    case 'GBP': return '£';
    case 'ZWL': return 'ZWL';
    default: return code + ' ';
  }
}
// Simple static mock FX just for demo (not real rates)
function convertCurrency(amount, code){
  const rates = {
    USD: 1,
    ZWL: +zwlRateInput.value || 13 // use input or fallback
  };
  return (+amount || 0) * (rates[code] ?? 1);
}


function refreshSalaryTableCurrency(){
  // Update salary table figures
  $$('#salaryRows td[data-raw]').forEach(td => {
    const base = +td.getAttribute('data-raw');
    td.textContent = `${currencySymbol(currentCurrency)} ${formatMoney(convertCurrency(base, currentCurrency))}`;
  });
  // Update calc totals
  updateCalculatorTotals();
}

/* ===========================
   Navigation / Views
   =========================== */
function gotoResults(){
  home.classList.add('hidden');
  resultsHeader.classList.remove('hidden');
  results.classList.remove('hidden');
  results.setAttribute('aria-busy','false');
  resultsQuery.focus();
}

function gotoHome(){
  home.classList.remove('hidden');
  resultsHeader.classList.add('hidden');
  results.classList.add('hidden');
  // clear transient state
  resultsQuery.value = '';
  jobCard.style.display = 'none';
  calcCard.style.display = 'none';
  extraCard.style.display = 'none';
  notFoundCard.style.display = 'none';
  homeQuery.focus();
}

/* ===========================
   Event wiring
   =========================== */
function wire(){
  // Home form
  homeForm.addEventListener('submit', (e)=>{
    e.preventDefault();
    const q = homeQuery.value;
    performSearch(q);
  });

  // Results form
  resultsForm.addEventListener('submit', (e)=>{
    e.preventDefault();
    const q = resultsQuery.value;
    performSearch(q);
  });

  // Suggestion demo chips (home + not found)
  document.addEventListener('click', (e)=>{
    const btn = e.target.closest('[data-demo]');
    if(btn){
      const q = btn.getAttribute('data-demo');
      homeQuery.value = q;
      resultsQuery.value = q;
      performSearch(q);
    }
  });

  // Back home
  backHomeBtn.addEventListener('click', gotoHome);

  // Institution selection -> basic changes
  instSelect.addEventListener('change', ()=>{
    basicInput.value = +instSelect.value || 0;
    updateCalculatorTotals();
  });

  // Currency selection
  currencySelect.addEventListener('change', ()=>{
    currentCurrency = currencySelect.value;
    refreshSalaryTableCurrency();
  });

  // Basic/allowances inputs
  document.addEventListener('input', (e)=>{
    if (e.target === basicInput || e.target.closest('#allowancesList')){
      updateCalculatorTotals();
    }
  });

  // Add custom allowance
  addAllowanceBtn.addEventListener('click', ()=>{
    const name = prompt('Allowance name:', 'Other');
    if(!name) return;
    const key = name.toLowerCase().replace(/[^a-z0-9]+/g,'-').slice(0,20) || 'custom';
    allowancesList.appendChild(makeAllowanceRow(name, key, 0));
    updateCalculatorTotals();
  });

  // Reset calc
  resetCalcBtn.addEventListener('click', ()=>{
    basicInput.value = +instSelect.value || 0;
    resetAllowances();
    updateCalculatorTotals();
  });

  // Enter from home hero chips
  $$('.btn.btn--chip').forEach(b=>{
    b.addEventListener('keydown', (e)=> {
      if (e.key === 'Enter' || e.key === ' '){ b.click(); }
    });
  });

  // Prefill default allowances initially
  resetAllowances();
}

/* ===========================
   Search orchestration
   =========================== */
function performSearch(q){
  results.setAttribute('aria-busy','true');
  resultsQuery.value = q;
  gotoResults();

  const job = findJob(q);
  if(job){
    renderJob(job, q);
  }else{
    renderNotFound(q);
  }
  results.setAttribute('aria-busy','false');
}

/* ===========================
   Helpers: sanitize
   =========================== */
function escapeHTML(str=''){
  return str.replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s]));
}
function escapeAttr(str=''){
  return escapeHTML(str).replace(/"/g,'&quot;');
}

/* ===========================
   Init
   =========================== */
wire();

</script>
</body>
</html>
